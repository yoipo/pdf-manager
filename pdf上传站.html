<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFÊñá‰ª∂‰∏ä‰º†Á´ô</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 2rem;
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            color: #6c757d;
            font-size: 1.1rem;
        }

        .auth-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
            margin: 0 8px;
            font-weight: 500;
        }

        .btn:hover {
            background: #0056b3;
        }

        .btn.secondary {
            background: #6c757d;
        }

        .btn.secondary:hover {
            background: #545b62;
        }

        .btn.danger {
            background: #dc3545;
        }

        .btn.danger:hover {
            background: #c82333;
        }

        .btn.success {
            background: #28a745;
        }

        .btn.success:hover {
            background: #1e7e34;
        }

        .btn.warning {
            background: #ffc107;
            color: #212529;
        }

        .btn.warning:hover {
            background: #e0a800;
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .password-input {
            display: none;
            margin-top: 20px;
        }

        .password-input input {
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            margin-right: 10px;
            width: 200px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .sidebar {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            height: fit-content;
            border: 1px solid #e9ecef;
        }

        .content-area {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .data-analysis {
            margin-bottom: 30px;
            padding-bottom: 24px;
            border-bottom: 1px solid #e9ecef;
        }

        .data-analysis h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
        }

        .analysis-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
            transition: all 0.2s;
        }

        .analysis-card:hover {
            border-color: #007bff;
            background: #f0f8ff;
        }

        .analysis-number {
            font-size: 1.8rem;
            font-weight: 600;
            color: #007bff;
            margin-bottom: 8px;
        }

        .analysis-label {
            color: #6c757d;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .upload-area {
            border: 2px dashed #ced4da;
            padding: 30px;
            text-align: center;
            border-radius: 6px;
            margin-bottom: 16px;
            background: #f8f9fa;
            transition: all 0.3s;
            color: #6c757d;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #007bff;
            background: #f0f8ff;
            transform: translateY(-1px);
        }

        .upload-area.dragover {
            border-color: #007bff;
            background: #e7f3ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .upload-text {
            font-weight: 500;
            color: #495057;
            margin-bottom: 5px;
        }

        .upload-hint {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 15px;
        }

        .upload-status {
            min-height: 24px;
            padding: 8px 0;
            text-align: center;
            font-size: 14px;
        }

        .upload-status.success {
            color: #28a745;
            font-weight: 500;
        }

        .upload-status.uploading {
            color: #007bff;
        }

        .upload-status.error {
            color: #dc3545;
            font-weight: 500;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 24px;
        }

        .search-box:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
        }

        .file-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .file-controls h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .file-controls-right {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .time-filter-section {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .download-section {
            display: flex;
            gap: 10px;
        }

        .time-filters {
            display: flex;
            gap: 6px;
        }

        .btn-filter {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #e9ecef;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-filter:hover {
            background: #e9ecef;
            border-color: #007bff;
        }

        .btn-filter.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .date-picker-section {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .date-picker-section input[type="date"] {
            padding: 6px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 12px;
            color: #495057;
        }

        .date-picker-section input[type="date"]:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
        }

        .file-view-controls {
            display: flex;
            gap: 10px;
        }

        .select-all-area {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .select-all-area input[type="checkbox"] {
            transform: scale(1.2);
        }

        .batch-actions {
            display: none;
            gap: 10px;
            margin-left: 20px;
        }

        .batch-actions.show {
            display: flex;
        }

        .file-list-simple {
            max-height: 600px;
            overflow-y: auto;
        }

        .file-list-simple.collapsed {
            max-height: 0;
            overflow: hidden;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            margin-bottom: 8px;
            background: #f8f9fa;
            transition: all 0.2s;
        }

        .file-item:hover {
            border-color: #007bff;
            background: #f0f8ff;
        }

        .file-item.selected {
            border-color: #007bff;
            background: #e7f3ff;
        }

        .file-checkbox {
            margin-right: 15px;
        }

        .file-checkbox input[type="checkbox"] {
            transform: scale(1.1);
        }

        .file-icon-simple {
            width: 32px;
            height: 32px;
            background: #dc3545;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 10px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .file-info {
            flex: 1;
            min-width: 0;
        }

        .file-name-simple {
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 4px;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-date-simple {
            color: #6c757d;
            font-size: 12px;
        }

        .file-actions-simple {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .file-actions-simple .btn {
            font-size: 12px;
            padding: 6px 12px;
        }

        .stats-section {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .stats-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .stats-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stats-nav .btn {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #e9ecef;
        }

        .stats-nav .btn:hover {
            background: #e9ecef;
        }

        .stats-nav .btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .stats-content {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-item.total {
            background: #e7f3ff;
            padding: 12px;
            margin: -16px -16px 12px -16px;
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            border-bottom: 1px solid #007bff;
        }

        .no-files {
            text-align: center;
            color: #6c757d;
            padding: 40px;
            font-size: 16px;
        }

        .user-indicator {
            display: inline-block;
            padding: 6px 16px;
            background: #28a745;
            color: white;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
        }

        .admin-only {
            display: none;
        }

        .admin-only.show {
            display: block;
        }

        .user-only {
            display: none;
        }

        .user-only.show {
            display: block;
        }

        input[type="file"] {
            display: none;
        }

        .file-input-label {
            display: inline-block;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .file-input-label:hover {
            background: #1e7e34;
        }

        .quick-stats {
            margin-top: 24px;
        }

        .quick-stats h4 {
            color: #2c3e50;
            margin-bottom: 16px;
            font-size: 1rem;
            font-weight: 600;
        }

        .data-backup-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e9ecef;
        }

        .data-backup-section h4 {
            color: #2c3e50;
            margin-bottom: 16px;
            font-size: 1rem;
            font-weight: 600;
        }

        .backup-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .backup-info {
            color: #6c757d;
            font-size: 11px;
            line-height: 1.4;
        }

        .time-download-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e9ecef;
        }

        .time-download-section h4 {
            color: #2c3e50;
            margin-bottom: 16px;
            font-size: 1rem;
            font-weight: 600;
        }

        .time-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .time-stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .time-stat-item:hover {
            border-color: #007bff;
            background: #f0f8ff;
        }

        .time-stat-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .time-stat-info span:first-child {
            font-weight: 500;
            color: #2c3e50;
            font-size: 14px;
        }

        .time-stat-info span:last-child {
            color: #6c757d;
            font-size: 12px;
        }

        .btn-small {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: background-color 0.2s;
            min-width: 50px;
        }

        .btn-small:hover {
            background: #1e7e34;
        }

        .btn-small:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-small.secondary {
            background: #6c757d;
        }

        .btn-small.secondary:hover {
            background: #545b62;
        }

        .btn-small.danger {
            background: #dc3545;
        }

        .btn-small.danger:hover {
            background: #c82333;
        }

        .selected-count {
            font-size: 12px;
            color: #007bff;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .file-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .file-controls-right {
                width: 100%;
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .time-filter-section {
                width: 100%;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .time-filters {
                width: 100%;
                justify-content: flex-start;
                flex-wrap: wrap;
            }
            
            .date-picker-section {
                width: 100%;
                justify-content: flex-start;
            }
            
            .download-section {
                width: 100%;
            }
            
            .select-all-area {
                width: 100%;
            }
            
            .file-view-controls {
                width: 100%;
            }
            
            .batch-actions {
                width: 100%;
                flex-direction: column;
            }
            
            .analysis-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-nav {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PDFÊñá‰ª∂ÁÆ°ÁêÜÁ´ô</h1>
            <p>ÁÆÄÊ¥ÅÈ´òÊïàÁöÑÊñáÊ°£ÁÆ°ÁêÜÂπ≥Âè∞</p>
        </div>

        <div class="auth-section">
            <div id="authButtons">
                <button class="btn" onclick="showPasswordInput()">ÁÆ°ÁêÜÂëòÁôªÂΩï</button>
                <button class="btn secondary" onclick="loginAsUser()">ËÆøÂÆ¢ÊµèËßà</button>
                
                <div class="password-input" id="passwordInput">
                    <input type="password" id="adminPassword" placeholder="ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòÂØÜÁ†Å">
                    <button class="btn" onclick="verifyPassword()">Á°ÆËÆ§</button>
                    <button class="btn secondary" onclick="hidePasswordInput()">ÂèñÊ∂à</button>
                </div>
            </div>
            
            <div id="userInfo" style="display: none;">
                <span id="userIndicator" class="user-indicator"></span>
                <button class="btn secondary" onclick="logout()">ÈÄÄÂá∫ÁôªÂΩï</button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <h3>Êñá‰ª∂Êìç‰Ωú</h3>
                
                <div class="admin-only" id="uploadSection">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">üìÑ</div>
                        <p class="upload-text">ÊãñÊãΩPDFÊñá‰ª∂Âà∞Ê≠§Â§Ñ Êàñ ÁÇπÂáªÈÄâÊã©</p>
                        <p class="upload-hint">ÊîØÊåÅÂ§öÊñá‰ª∂ÂêåÊó∂‰∏ä‰º† ‚Ä¢ Âø´Êç∑ÈîÆ Ctrl+O</p>
                        <label for="fileInput" class="file-input-label">ÈÄâÊã©PDFÊñá‰ª∂</label>
                        <input type="file" id="fileInput" accept=".pdf" multiple>
                    </div>
                    <div class="upload-status" id="uploadStatus"></div>
                </div>

                <input type="text" class="search-box" id="searchInput" placeholder="ÊêúÁ¥¢PDFÊñá‰ª∂Âêç...">
                
                <div class="quick-stats">
                    <h4>ÁªüËÆ°Ê¶ÇËßà</h4>
                    <div class="stat-item">
                        <span>ÊÄªÊñá‰ª∂Êï∞</span>
                        <span id="totalFiles">0</span>
                    </div>
                    <div class="stat-item">
                        <span>‰ªäÊó•‰∏ä‰º†</span>
                        <span id="todayFiles">0</span>
                    </div>
                    <div class="stat-item">
                        <span>ÂΩìÂâçÊòæÁ§∫</span>
                        <span id="visibleFiles">0</span>
                    </div>
                    <div class="admin-only stat-item">
                        <span>Â∑≤ÈÄâÊã©</span>
                        <span id="selectedCount">0</span>
                    </div>
                </div>

                <!-- Êï∞ÊçÆÂ§á‰ªΩÂäüËÉΩ -->
                <div class="data-backup-section">
                    <h4>Êï∞ÊçÆÂ§á‰ªΩ</h4>
                    <div class="backup-controls">
                        <button class="btn-small secondary" onclick="exportData()">ÂØºÂá∫Êï∞ÊçÆ</button>
                        <label for="importDataInput" class="btn-small success">
                            ÂØºÂÖ•Êï∞ÊçÆ
                            <input type="file" id="importDataInput" accept=".json" style="display: none;" onchange="importData(event)">
                        </label>
                        <div class="admin-only">
                            <button class="btn-small danger" onclick="clearAllData()">Ê∏ÖÁ©∫Êï∞ÊçÆ</button>
                        </div>
                    </div>
                    <div class="backup-info">
                        <small>üí° ÂØºÂá∫Êï∞ÊçÆÂèØ‰øùÂ≠òÊâÄÊúâÊñá‰ª∂ÔºåÂØºÂÖ•ÂèØÊÅ¢Â§ç</small>
                    </div>
                </div>

                <!-- ËÆøÂÆ¢‰∏ìÂ±ûÔºöÊó∂Èó¥ÊÆµ‰∏ãËΩΩ -->
                <div class="user-only time-download-section">
                    <h4>Êó∂Èó¥ÊÆµ‰∏ãËΩΩ</h4>
                    <div class="time-stats" id="timeStats">
                        <div class="time-stat-item">
                            <div class="time-stat-info">
                                <span>‰ªäÊó•</span>
                                <span id="todayCount">0 ‰∏™Êñá‰ª∂</span>
                            </div>
                            <button class="btn-small" onclick="downloadByPeriod('today')">‰∏ãËΩΩ</button>
                        </div>
                        <div class="time-stat-item">
                            <div class="time-stat-info">
                                <span>Êú¨Âë®</span>
                                <span id="weekCount">0 ‰∏™Êñá‰ª∂</span>
                            </div>
                            <button class="btn-small" onclick="downloadByPeriod('week')">‰∏ãËΩΩ</button>
                        </div>
                        <div class="time-stat-item">
                            <div class="time-stat-info">
                                <span>Êú¨Êúà</span>
                                <span id="monthCount">0 ‰∏™Êñá‰ª∂</span>
                            </div>
                            <button class="btn-small" onclick="downloadByPeriod('month')">‰∏ãËΩΩ</button>
                        </div>
                        <div class="time-stat-item">
                            <div class="time-stat-info">
                                <span>Êú¨Âπ¥</span>
                                <span id="yearCount">0 ‰∏™Êñá‰ª∂</span>
                            </div>
                            <button class="btn-small" onclick="downloadByPeriod('year')">‰∏ãËΩΩ</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-area">
                <!-- ËÆøÂÆ¢‰∏ìÂ±ûÔºöÁÆÄÊ¥ÅÊï∞ÊçÆÂàÜÊûê -->
                <div class="user-only data-analysis" id="dataAnalysis">
                    <h3>Êï∞ÊçÆÊ¶ÇËßà</h3>
                    <div class="analysis-grid">
                        <div class="analysis-card">
                            <div class="analysis-number" id="analysisTotal">0</div>
                            <div class="analysis-label">ÊÄªÊñá‰ª∂Êï∞</div>
                        </div>
                        <div class="analysis-card">
                            <div class="analysis-number" id="analysisAvgDaily">0</div>
                            <div class="analysis-label">Êó•Âùá‰∏ä‰º†</div>
                        </div>
                        <div class="analysis-card">
                            <div class="analysis-number" id="analysisMostActive">-</div>
                            <div class="analysis-label">ÊúÄÊ¥ªË∑ÉÊó•Êúü</div>
                        </div>
                        <div class="analysis-card">
                            <div class="analysis-number" id="analysisRecentTrend">-</div>
                            <div class="analysis-label">ËøëÊúüË∂ãÂäø</div>
                        </div>
                    </div>
                </div>

                <div class="file-controls">
                    <h3>Êñá‰ª∂ÂàóË°®</h3>
                    <div class="file-controls-right">
                        <!-- Êó∂Èó¥Á≠õÈÄâÔºàÁÆ°ÁêÜÂëòÂíåËÆøÂÆ¢ÈÄöÁî®Ôºâ -->
                        <div class="time-filter-section">
                            <div class="time-filters">
                                <button class="btn-filter active" data-period="all" onclick="filterByTime('all')">ÂÖ®ÈÉ®</button>
                                <button class="btn-filter" data-period="today" onclick="filterByTime('today')">‰ªäÂ§©</button>
                                <button class="btn-filter" data-period="week" onclick="filterByTime('week')">Êú¨Âë®</button>
                                <button class="btn-filter" data-period="month" onclick="filterByTime('month')">Êú¨Êúà</button>
                            </div>
                            <div class="date-picker-section">
                                <input type="date" id="specificDate" onchange="filterBySpecificDate()" title="ÈÄâÊã©ÁâπÂÆöÊó•Êúü">
                                <button class="btn-filter" onclick="clearDateFilter()">Ê∏ÖÈô§</button>
                            </div>
                        </div>
                        
                        <!-- ËÆøÂÆ¢‰∏ìÂ±û‰∏ãËΩΩ -->
                        <div class="user-only download-section">
                            <button class="btn success" onclick="downloadFiltered()">‰∏ãËΩΩÁ≠õÈÄâ</button>
                        </div>
                        
                        <!-- ÁÆ°ÁêÜÂëòÊéßÂà∂ -->
                        <div class="admin-only select-all-area">
                            <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()">
                            <label for="selectAllCheckbox">ÂÖ®ÈÄâ</label>
                            <span class="selected-count" id="selectedCountText"></span>
                        </div>
                        
                        <!-- ËÆøÂÆ¢Êî∂Ëµ∑ÊéßÂà∂ -->
                        <div class="user-only file-view-controls">
                            <button class="btn secondary" id="toggleViewBtn" onclick="toggleFileView()">Êî∂Ëµ∑ÂàóË°®</button>
                        </div>
                        
                        <!-- ÊâπÈáèÊìç‰ΩúÊåâÈíÆ -->
                        <div class="batch-actions admin-only" id="batchActions">
                            <button class="btn danger" onclick="deleteSelected()">Âà†Èô§ÈÄâ‰∏≠</button>
                            <button class="btn warning" onclick="deleteFiltered()">Âà†Èô§Á≠õÈÄâ</button>
                        </div>
                    </div>
                </div>
                
                <div class="file-list-simple" id="fileList">
                    <div class="no-files">ÊöÇÊó†PDFÊñá‰ª∂</div>
                </div>
            </div>
        </div>

        <div class="stats-section">
            <h3>ÁªüËÆ°ÂàÜÊûê</h3>
            <div class="stats-nav">
                <button class="btn active" onclick="showStats('week')">Êú¨Âë®</button>
                <button class="btn" onclick="showStats('month')">Êú¨Êúà</button>
                <button class="btn" onclick="showStats('year')">Êú¨Âπ¥</button>
            </div>
            <div class="stats-content" id="statsContent">
                <div class="no-files">ÈÄâÊã©Êó∂Èó¥ËåÉÂõ¥Êü•ÁúãÁªüËÆ°Êï∞ÊçÆ</div>
            </div>
        </div>
    </div>

    <script>
        // ÁÆ°ÁêÜÂëòÂØÜÁ†Å
        const ADMIN_PASSWORD = '141617';
        
        // Êï∞ÊçÆÂ≠òÂÇ®
        let files = [];
        let currentUser = null;
        let currentStatsView = 'week';
        let selectedFiles = new Set();
        let fileListCollapsed = false;
        let currentTimeFilter = 'all';
        let specificDateFilter = null;

        // ==========================================
        // Â∑≤ÂêØÁî®localStorageÊï∞ÊçÆÊåÅ‰πÖÂåñÂäüËÉΩ
        // ==========================================

        // ÂàùÂßãÂåñÊó∂Âä†ËΩΩ‰øùÂ≠òÁöÑÊï∞ÊçÆ
        function initializeData() {
            try {
                const savedData = localStorage.getItem('pdfManagerData');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    if (parsedData.files && Array.isArray(parsedData.files)) {
                        console.log('‰ªélocalStorageÊÅ¢Â§çÂÖÉÊï∞ÊçÆ:', parsedData.files.length, '‰∏™Êñá‰ª∂ËÆ∞ÂΩï');
                        
                        // Ê≥®ÊÑèÔºölocalStorageÂè™ËÉΩ‰øùÂ≠òÊñá‰ª∂ÂÖÉÊï∞ÊçÆÔºå‰∏çËÉΩ‰øùÂ≠òÂÆûÈôÖÊñá‰ª∂ÂÜÖÂÆπ
                        // ÂÆûÈôÖÊñá‰ª∂ÂÜÖÂÆπÈúÄË¶ÅÁî®Êà∑ÈáçÊñ∞‰∏ä‰º†Êàñ‰ΩøÁî®ÂØºÂÖ•/ÂØºÂá∫ÂäüËÉΩ
                        
                        // ËøôÈáåÂèØ‰ª•ÊòæÁ§∫Êñá‰ª∂ÂàóË°®Ôºå‰ΩÜÊó†Ê≥ïÊèê‰æõÊü•Áúã/‰∏ãËΩΩÂäüËÉΩ
                        // Êé®ËçêÁî®Êà∑‰ΩøÁî®ÂØºÂÖ•/ÂØºÂá∫ÂäüËÉΩÊù•ÂÆûÁé∞ÂÆåÊï¥ÁöÑÊï∞ÊçÆÂ§á‰ªΩ
                    }
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
            
            console.log('Êï∞ÊçÆÂàùÂßãÂåñÂÆåÊàê - localStorageÂ∑≤ÂêØÁî®');
            console.log('üí° ÊèêÁ§∫Ôºö‰ΩøÁî®"ÂØºÂá∫Êï∞ÊçÆ"ÂäüËÉΩÂèØ‰ª•‰øùÂ≠òÂÆåÊï¥ÁöÑPDFÊñá‰ª∂ÂÜÖÂÆπ');
        }

        // ‰øùÂ≠òÊï∞ÊçÆÂà∞localStorage
        function saveData() {
            try {
                // ‰øùÂ≠òÊñá‰ª∂ÂÖÉÊï∞ÊçÆÔºà‰∏çÂåÖÂê´ÂÆûÈôÖÊñá‰ª∂ÂÜÖÂÆπÔºâ
                const dataToSave = {
                    version: '1.0',
                    lastUpdate: new Date().toISOString(),
                    files: files.map(file => ({
                        id: file.id,
                        name: file.name,
                        size: file.size,
                        uploadDate: file.uploadDate.toISOString()
                        // Ê≥®ÊÑèÔºöÂÆûÈôÖPDFÊñá‰ª∂ÂÜÖÂÆπÊó†Ê≥ïÂ≠òÂÇ®Âú®localStorage‰∏≠
                        // Êé®Ëçê‰ΩøÁî®ÂØºÂÖ•/ÂØºÂá∫ÂäüËÉΩÂÆûÁé∞ÂÆåÊï¥Â§á‰ªΩ
                    }))
                };
                
                localStorage.setItem('pdfManagerData', JSON.stringify(dataToSave));
                console.log('ÂÖÉÊï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞localStorage');
            } catch (error) {
                console.error('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }

        // Êï∞ÊçÆÂ§á‰ªΩÂäüËÉΩ
        async function exportData() {
            if (files.length === 0) {
                alert('Ê≤°ÊúâÊï∞ÊçÆÂèØ‰ª•ÂØºÂá∫');
                return;
            }

            try {
                const exportBtn = event.target;
                const originalText = exportBtn.textContent;
                exportBtn.disabled = true;
                exportBtn.textContent = 'ÂØºÂá∫‰∏≠...';

                // Â∞ÜFileÂØπË±°ËΩ¨Êç¢‰∏∫base64Ê†ºÂºèËøõË°åÂØºÂá∫
                const exportData = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    totalFiles: files.length,
                    files: []
                };

                for (let file of files) {
                    try {
                        // Â∞ÜPDFÊñá‰ª∂ËΩ¨Êç¢‰∏∫base64
                        const arrayBuffer = await file.file.arrayBuffer();
                        const base64 = btoa(String.fromCharCode.apply(null, new Uint8Array(arrayBuffer)));
                        
                        exportData.files.push({
                            id: file.id,
                            name: file.name,
                            size: file.size,
                            uploadDate: file.uploadDate.toISOString(),
                            fileData: base64
                        });
                    } catch (error) {
                        console.error('ÂØºÂá∫Êñá‰ª∂Â§±Ë¥•:', file.name, error);
                    }
                }

                // ÂàõÂª∫Âπ∂‰∏ãËΩΩJSONÊñá‰ª∂
                const dataStr = JSON.stringify(exportData, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `pdf-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);

                exportBtn.disabled = false;
                exportBtn.textContent = originalText;
                alert(`ÊàêÂäüÂØºÂá∫ ${exportData.files.length} ‰∏™Êñá‰ª∂ÁöÑÊï∞ÊçÆÔºÅ`);
            } catch (error) {
                console.error('ÂØºÂá∫Êï∞ÊçÆÂ§±Ë¥•:', error);
                alert('ÂØºÂá∫Êï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
                event.target.disabled = false;
                event.target.textContent = 'ÂØºÂá∫Êï∞ÊçÆ';
            }
        }

        async function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const importLabel = event.target.parentElement;
                const originalText = importLabel.textContent;
                importLabel.style.pointerEvents = 'none';
                importLabel.textContent = 'ÂØºÂÖ•‰∏≠...';

                const text = await file.text();
                const importData = JSON.parse(text);

                if (!importData.version || !importData.files || !Array.isArray(importData.files)) {
                    throw new Error('Êó†ÊïàÁöÑÂ§á‰ªΩÊñá‰ª∂Ê†ºÂºè');
                }

                let importedCount = 0;
                let errorCount = 0;

                for (let fileData of importData.files) {
                    try {
                        // Â∞Übase64ËΩ¨Êç¢ÂõûFileÂØπË±°
                        const binaryString = atob(fileData.fileData);
                        const bytes = new Uint8Array(binaryString.length);
                        for (let i = 0; i < binaryString.length; i++) {
                            bytes[i] = binaryString.charCodeAt(i);
                        }
                        const blob = new Blob([bytes], { type: 'application/pdf' });
                        const restoredFile = new File([blob], fileData.name, { type: 'application/pdf' });

                        const fileObj = {
                            id: fileData.id || Date.now() + Math.random(),
                            name: fileData.name,
                            size: fileData.size,
                            uploadDate: new Date(fileData.uploadDate),
                            file: restoredFile
                        };

                        files.push(fileObj);
                        importedCount++;
                    } catch (error) {
                        console.error('ÂØºÂÖ•Êñá‰ª∂Â§±Ë¥•:', fileData.name, error);
                        errorCount++;
                    }
                }

                saveData();
                updateFileDisplay();
                updateStats();

                importLabel.style.pointerEvents = '';
                importLabel.textContent = originalText;
                event.target.value = ''; // Ê∏ÖÁ©∫input

                let message = `ÊàêÂäüÂØºÂÖ• ${importedCount} ‰∏™Êñá‰ª∂`;
                if (errorCount > 0) {
                    message += `Ôºå${errorCount} ‰∏™Êñá‰ª∂ÂØºÂÖ•Â§±Ë¥•`;
                }
                alert(message + 'ÔºÅ');

            } catch (error) {
                console.error('ÂØºÂÖ•Êï∞ÊçÆÂ§±Ë¥•:', error);
                alert('ÂØºÂÖ•Êï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ê†ºÂºè');
                event.target.parentElement.style.pointerEvents = '';
                event.target.parentElement.textContent = 'ÂØºÂÖ•Êï∞ÊçÆ';
                event.target.value = '';
            }
        }

        function clearAllData() {
            if (files.length === 0) {
                alert('Ê≤°ÊúâÊï∞ÊçÆÈúÄË¶ÅÊ∏ÖÁ©∫');
                return;
            }

            if (confirm(`Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâ ${files.length} ‰∏™Êñá‰ª∂ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ\n\nÂª∫ËÆÆÂú®Ê∏ÖÁ©∫ÂâçÂÖàÂØºÂá∫Â§á‰ªΩ„ÄÇ`)) {
                files = [];
                selectedFiles.clear();
                saveData();
                updateFileDisplay();
                updateStats();
                alert('ÊâÄÊúâÊï∞ÊçÆÂ∑≤Ê∏ÖÁ©∫ÔºÅ');
            }
        }

        // ÂØÜÁ†ÅÈ™åËØÅ
        function showPasswordInput() {
            document.getElementById('passwordInput').style.display = 'block';
            document.getElementById('adminPassword').focus();
        }

        function hidePasswordInput() {
            document.getElementById('passwordInput').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }

        function verifyPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                currentUser = { type: 'admin', name: 'ÁÆ°ÁêÜÂëò' };
                hidePasswordInput();
                updateUI();
            } else {
                alert('ÂØÜÁ†ÅÈîôËØØÔºåËØ∑ÈáçËØï');
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }

        // Áî®Êà∑ÁÆ°ÁêÜ
        function loginAsUser() {
            currentUser = { type: 'user', name: 'ËÆøÂÆ¢' };
            updateUI();
        }

        function logout() {
            currentUser = null;
            selectedFiles.clear();
            fileListCollapsed = false;
            currentTimeFilter = 'all';
            specificDateFilter = null;
            updateUI();
        }

        function updateUI() {
            const authButtons = document.getElementById('authButtons');
            const userInfo = document.getElementById('userInfo');
            const userIndicator = document.getElementById('userIndicator');
            const adminSections = document.querySelectorAll('.admin-only');
            const userSections = document.querySelectorAll('.user-only');

            if (currentUser) {
                authButtons.style.display = 'none';
                userInfo.style.display = 'block';
                userIndicator.textContent = `${currentUser.name}`;
                userIndicator.style.background = currentUser.type === 'admin' ? '#007bff' : '#28a745';

                if (currentUser.type === 'admin') {
                    adminSections.forEach(section => section.classList.add('show'));
                    userSections.forEach(section => section.classList.remove('show'));
                } else {
                    adminSections.forEach(section => section.classList.remove('show'));
                    userSections.forEach(section => section.classList.add('show'));
                }
                
                // ÂàùÂßãÂåñÁ≠õÈÄâÊåâÈíÆÁä∂ÊÄÅÔºàÁÆ°ÁêÜÂëòÂíåËÆøÂÆ¢ÈÄöÁî®Ôºâ
                setTimeout(() => {
                    document.querySelectorAll('.btn-filter[data-period]').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    const allBtn = document.querySelector('.btn-filter[data-period="all"]');
                    if (allBtn) allBtn.classList.add('active');
                    
                    // ÈáçÁΩÆÁ≠õÈÄâÁä∂ÊÄÅ
                    currentTimeFilter = 'all';
                    specificDateFilter = null;
                    document.getElementById('specificDate').value = '';
                }, 0);
            } else {
                authButtons.style.display = 'block';
                userInfo.style.display = 'none';
                adminSections.forEach(section => section.classList.remove('show'));
                userSections.forEach(section => section.classList.remove('show'));
            }
            
            updateFileDisplay();
        }

        // ÊîØÊåÅEnterÈîÆÁôªÂΩï
        document.getElementById('adminPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyPassword();
            }
        });

        // Êñá‰ª∂‰∏ä‰º†
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('click', () => {
            if (currentUser && currentUser.type === 'admin') {
                fileInput.click();
            }
        });

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            if (currentUser && currentUser.type === 'admin') {
                uploadArea.classList.add('dragover');
            }
        });

        uploadArea.addEventListener('dragleave', (e) => {
            // Âè™ÊúâÂΩìÊãñÊãΩÂÆåÂÖ®Á¶ªÂºÄuploadAreaÊó∂ÊâçÁßªÈô§Ê†∑Âºè
            if (!uploadArea.contains(e.relatedTarget)) {
                uploadArea.classList.remove('dragover');
            }
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            if (currentUser && currentUser.type === 'admin') {
                const droppedFiles = Array.from(e.dataTransfer.files);
                handleFiles(droppedFiles);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const selectedFiles = Array.from(e.target.files);
            handleFiles(selectedFiles);
        });

        function handleFiles(fileList) {
            const uploadStatus = document.getElementById('uploadStatus');
            const pdfFiles = Array.from(fileList).filter(file => file.type === 'application/pdf');
            const nonPdfFiles = fileList.length - pdfFiles.length;
            
            if (pdfFiles.length === 0) {
                showUploadStatus('ËØ∑ÈÄâÊã©PDFÊñá‰ª∂', 'error');
                return;
            }
            
            // ÊòæÁ§∫‰∏ä‰º†‰∏≠Áä∂ÊÄÅ
            showUploadStatus(`Ê≠£Âú®‰∏ä‰º† ${pdfFiles.length} ‰∏™Êñá‰ª∂...`, 'uploading');
            
            let uploadedCount = 0;
            pdfFiles.forEach(file => {
                const fileObj = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    uploadDate: new Date(),
                    file: file
                };
                files.push(fileObj);
                uploadedCount++;
            });
            
            // Á´ãÂç≥‰øùÂ≠òÂíåÊõ¥Êñ∞
            saveData();
            updateFileDisplay();
            updateStats();
            
            // ÊòæÁ§∫ÊàêÂäüÁä∂ÊÄÅ
            let successMessage = `‚úÖ ÊàêÂäü‰∏ä‰º† ${uploadedCount} ‰∏™PDFÊñá‰ª∂`;
            if (nonPdfFiles > 0) {
                successMessage += `ÔºåË∑≥Ëøá ${nonPdfFiles} ‰∏™ÈùûPDFÊñá‰ª∂`;
            }
            showUploadStatus(successMessage, 'success');
            
            // 3ÁßíÂêéÊ∏ÖÈô§Áä∂ÊÄÅ‰ø°ÊÅØ
            setTimeout(() => {
                showUploadStatus('', '');
            }, 3000);
            
            // Ê∏ÖÁ©∫Êñá‰ª∂ËæìÂÖ•
            document.getElementById('fileInput').value = '';
        }

        function showUploadStatus(message, type) {
            const uploadStatus = document.getElementById('uploadStatus');
            if (uploadStatus) {
                uploadStatus.textContent = message;
                uploadStatus.className = `upload-status ${type}`;
            }
        }

        // Êó∂Èó¥Á≠õÈÄâÂäüËÉΩ
        function filterByTime(period) {
            currentTimeFilter = period;
            specificDateFilter = null;
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.btn-filter[data-period]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.btn-filter[data-period="${period}"]`).classList.add('active');
            
            // Ê∏ÖÈô§ÁâπÂÆöÊó•Êúü
            document.getElementById('specificDate').value = '';
            
            // Ê∏ÖÁ©∫ÈÄâÊã©Âπ∂Êõ¥Êñ∞ÊòæÁ§∫
            selectedFiles.clear();
            updateFileDisplay();
            updateStats();
            updateSelectedCount(); // Êõ¥Êñ∞ÊâπÈáèÊìç‰ΩúÊåâÈíÆÁä∂ÊÄÅ
        }

        function filterBySpecificDate() {
            const dateInput = document.getElementById('specificDate');
            const selectedDate = dateInput.value;
            
            if (selectedDate) {
                specificDateFilter = new Date(selectedDate);
                currentTimeFilter = 'specific';
                
                // ÂèñÊ∂àÂÖ∂‰ªñÁ≠õÈÄâÊåâÈíÆÁöÑÊøÄÊ¥ªÁä∂ÊÄÅ
                document.querySelectorAll('.btn-filter[data-period]').forEach(btn => {
                    btn.classList.remove('active');
                });
            } else {
                specificDateFilter = null;
                currentTimeFilter = 'all';
                document.querySelector('.btn-filter[data-period="all"]').classList.add('active');
            }
            
            // Ê∏ÖÁ©∫ÈÄâÊã©Âπ∂Êõ¥Êñ∞ÊòæÁ§∫
            selectedFiles.clear();
            updateFileDisplay();
            updateStats();
            updateSelectedCount(); // Êõ¥Êñ∞ÊâπÈáèÊìç‰ΩúÊåâÈíÆÁä∂ÊÄÅ
        }

        function clearDateFilter() {
            document.getElementById('specificDate').value = '';
            specificDateFilter = null;
            filterByTime('all');
        }

        // ‰∏ãËΩΩÁ≠õÈÄâÁªìÊûú
        function downloadFiltered() {
            const filteredFiles = getFilteredFiles();
            
            if (filteredFiles.length === 0) {
                alert('ÂΩìÂâçÁ≠õÈÄâÊù°‰ª∂‰∏ãÊ≤°ÊúâÊñá‰ª∂ÂèØ‰∏ãËΩΩ');
                return;
            }
            
            let periodName = '';
            if (currentTimeFilter === 'specific' && specificDateFilter) {
                periodName = specificDateFilter.toLocaleDateString('zh-CN');
            } else {
                const periodNames = {
                    'all': 'ÂÖ®ÈÉ®',
                    'today': '‰ªäÊó•',
                    'week': 'Êú¨Âë®', 
                    'month': 'Êú¨Êúà'
                };
                periodName = periodNames[currentTimeFilter] || 'Á≠õÈÄâ';
            }
            
            if (filteredFiles.length > 10) {
                if (!confirm(`Âç≥Â∞Ü‰∏ãËΩΩ${periodName}ÁöÑ ${filteredFiles.length} ‰∏™Êñá‰ª∂ÔºåÁ°ÆÂÆöÁªßÁª≠ÂêóÔºü`)) {
                    return;
                }
            }
            
            const downloadBtn = event.target;
            const originalText = downloadBtn.textContent;
            let downloaded = 0;
            
            downloadBtn.disabled = true;
            downloadBtn.textContent = `‰∏ãËΩΩ‰∏≠... (0/${filteredFiles.length})`;
            
            // ÈÄê‰∏™‰∏ãËΩΩÊñá‰ª∂
            filteredFiles.forEach((file, index) => {
                setTimeout(() => {
                    const url = URL.createObjectURL(file.file);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = file.name;
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    downloaded++;
                    downloadBtn.textContent = `‰∏ãËΩΩ‰∏≠... (${downloaded}/${filteredFiles.length})`;
                    
                    // ÊâÄÊúâÊñá‰ª∂‰∏ãËΩΩÂÆåÊàê
                    if (downloaded === filteredFiles.length) {
                        setTimeout(() => {
                            downloadBtn.disabled = false;
                            downloadBtn.textContent = originalText;
                            alert(`ÊàêÂäü‰∏ãËΩΩ${periodName}ÁöÑ ${filteredFiles.length} ‰∏™Êñá‰ª∂ÔºÅ`);
                        }, 500);
                    }
                }, index * 300);
            });
        }

        // ÊåâÊó∂Èó¥ÊÆµ‰∏ãËΩΩÊñá‰ª∂
        function downloadByPeriod(period) {
            const periodFiles = getFilesByPeriod(period);
            
            if (periodFiles.length === 0) {
                alert(`${getPeriodName(period)}Ê≤°ÊúâÊñá‰ª∂ÂèØ‰∏ãËΩΩ`);
                return;
            }
            
            if (periodFiles.length > 10) {
                if (!confirm(`Âç≥Â∞Ü‰∏ãËΩΩ${getPeriodName(period)}ÁöÑ ${periodFiles.length} ‰∏™Êñá‰ª∂ÔºåÁ°ÆÂÆöÁªßÁª≠ÂêóÔºü`)) {
                    return;
                }
            }
            
            const downloadBtn = event.target;
            const originalText = downloadBtn.textContent;
            let downloaded = 0;
            
            downloadBtn.disabled = true;
            downloadBtn.textContent = `${downloaded}/${periodFiles.length}`;
            
            // ÈÄê‰∏™‰∏ãËΩΩÊñá‰ª∂
            periodFiles.forEach((file, index) => {
                setTimeout(() => {
                    const url = URL.createObjectURL(file.file);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = file.name;
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    downloaded++;
                    downloadBtn.textContent = `${downloaded}/${periodFiles.length}`;
                    
                    // ÊâÄÊúâÊñá‰ª∂‰∏ãËΩΩÂÆåÊàê
                    if (downloaded === periodFiles.length) {
                        setTimeout(() => {
                            downloadBtn.disabled = false;
                            downloadBtn.textContent = originalText;
                            alert(`ÊàêÂäü‰∏ãËΩΩ${getPeriodName(period)}ÁöÑ ${periodFiles.length} ‰∏™Êñá‰ª∂ÔºÅ`);
                        }, 500);
                    }
                }, index * 300);
            });
        }

        // Ëé∑ÂèñÊåáÂÆöÊó∂Èó¥ÊÆµÁöÑÊñá‰ª∂
        function getFilesByPeriod(period) {
            const now = new Date();
            let startDate;

            switch (period) {
                case 'today':
                    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    break;
                case 'week':
                    const dayOfWeek = now.getDay();
                    const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
                    startDate = new Date(now.getTime() - daysToMonday * 24 * 60 * 60 * 1000);
                    startDate.setHours(0, 0, 0, 0);
                    break;
                case 'month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    break;
                case 'year':
                    startDate = new Date(now.getFullYear(), 0, 1);
                    break;
                default:
                    return [];
            }

            return files.filter(file => file.uploadDate >= startDate);
        }

        // Ëé∑ÂèñÊó∂Èó¥ÊÆµÂêçÁß∞
        function getPeriodName(period) {
            const names = {
                'today': '‰ªäÊó•',
                'week': 'Êú¨Âë®',
                'month': 'Êú¨Êúà',
                'year': 'Êú¨Âπ¥'
            };
            return names[period] || '';
        }

        // Êõ¥Êñ∞Êó∂Èó¥ÊÆµÁªüËÆ°
        function updateTimeStats() {
            if (currentUser && currentUser.type === 'user') {
                const todayFiles = getFilesByPeriod('today');
                const weekFiles = getFilesByPeriod('week');
                const monthFiles = getFilesByPeriod('month');
                const yearFiles = getFilesByPeriod('year');

                const todayCountElement = document.getElementById('todayCount');
                const weekCountElement = document.getElementById('weekCount');
                const monthCountElement = document.getElementById('monthCount');
                const yearCountElement = document.getElementById('yearCount');

                if (todayCountElement) todayCountElement.textContent = `${todayFiles.length} ‰∏™Êñá‰ª∂`;
                if (weekCountElement) weekCountElement.textContent = `${weekFiles.length} ‰∏™Êñá‰ª∂`;
                if (monthCountElement) monthCountElement.textContent = `${monthFiles.length} ‰∏™Êñá‰ª∂`;
                if (yearCountElement) yearCountElement.textContent = `${yearFiles.length} ‰∏™Êñá‰ª∂`;
            }
        }

        // Êõ¥Êñ∞Êï∞ÊçÆÂàÜÊûê
        function updateDataAnalysis() {
            if (currentUser && currentUser.type === 'user') {
                const totalFiles = files.length;
                
                // ËÆ°ÁÆóÊó•Âùá‰∏ä‰º†
                let avgDaily = 0;
                let mostActiveDate = '-';
                let recentTrend = '-';
                
                if (totalFiles > 0) {
                    // Ëé∑ÂèñÊúÄÊó©ÂíåÊúÄÊôöÁöÑ‰∏ä‰º†Êó•Êúü
                    const dates = files.map(file => file.uploadDate);
                    const earliestDate = new Date(Math.min.apply(null, dates));
                    const latestDate = new Date(Math.max.apply(null, dates));
                    const daysDiff = Math.max(1, Math.ceil((latestDate - earliestDate) / (1000 * 60 * 60 * 24)) + 1);
                    
                    avgDaily = Math.round(totalFiles / daysDiff * 10) / 10;
                    
                    // ÊâæÂá∫ÊúÄÊ¥ªË∑ÉÁöÑÊó•ÊúüÔºà‰∏ä‰º†ÊúÄÂ§öÊñá‰ª∂ÁöÑÊó•ÊúüÔºâ
                    const dateGroups = {};
                    files.forEach(file => {
                        const dateKey = file.uploadDate.toDateString();
                        dateGroups[dateKey] = (dateGroups[dateKey] || 0) + 1;
                    });
                    
                    let maxCount = 0;
                    Object.entries(dateGroups).forEach(([date, count]) => {
                        if (count > maxCount) {
                            maxCount = count;
                            mostActiveDate = new Date(date).toLocaleDateString('zh-CN');
                        }
                    });
                    
                    // ËÆ°ÁÆóËøëÊúüË∂ãÂäøÔºàÊúÄËøë7Â§© vs ‰πãÂâç7Â§©Ôºâ
                    const now = new Date();
                    const recentWeekStart = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    const previousWeekStart = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);
                    
                    const recentWeekFiles = files.filter(file => file.uploadDate >= recentWeekStart);
                    const previousWeekFiles = files.filter(file => 
                        file.uploadDate >= previousWeekStart && file.uploadDate < recentWeekStart
                    );
                    
                    if (previousWeekFiles.length > 0) {
                        const change = recentWeekFiles.length - previousWeekFiles.length;
                        if (change > 0) {
                            recentTrend = `‚Üó +${change}`;
                        } else if (change < 0) {
                            recentTrend = `‚Üò ${change}`;
                        } else {
                            recentTrend = '‚Üí ÊåÅÂπ≥';
                        }
                    } else if (recentWeekFiles.length > 0) {
                        recentTrend = '‚Üó Êñ∞Â¢û';
                    }
                }
                
                // Êõ¥Êñ∞ÁïåÈù¢
                const analysisTotal = document.getElementById('analysisTotal');
                const analysisAvgDaily = document.getElementById('analysisAvgDaily');
                const analysisMostActive = document.getElementById('analysisMostActive');
                const analysisRecentTrend = document.getElementById('analysisRecentTrend');
                
                if (analysisTotal) analysisTotal.textContent = totalFiles;
                if (analysisAvgDaily) analysisAvgDaily.textContent = avgDaily;
                if (analysisMostActive) analysisMostActive.textContent = mostActiveDate;
                if (analysisRecentTrend) analysisRecentTrend.textContent = recentTrend;
            }
        }

        // ÂÖ®ÈÄâÂäüËÉΩ
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            const filteredFiles = getFilteredFiles();
            
            if (selectAllCheckbox.checked) {
                filteredFiles.forEach(file => selectedFiles.add(file.id));
            } else {
                selectedFiles.clear();
            }
            
            updateFileDisplay();
            updateSelectedCount();
        }

        function toggleFileSelection(fileId) {
            if (selectedFiles.has(fileId)) {
                selectedFiles.delete(fileId);
            } else {
                selectedFiles.add(fileId);
            }
            
            updateFileDisplay();
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const count = selectedFiles.size;
            const selectedCountElement = document.getElementById('selectedCount');
            const selectedCountText = document.getElementById('selectedCountText');
            const batchActions = document.getElementById('batchActions');
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            
            if (selectedCountElement) {
                selectedCountElement.textContent = count;
            }
            
            if (selectedCountText) {
                selectedCountText.textContent = count > 0 ? `(${count}‰∏™)` : '';
            }
            
            if (batchActions && currentUser && currentUser.type === 'admin') {
                const filteredFiles = getFilteredFiles();
                const hasFilteredFiles = filteredFiles.length > 0 && currentTimeFilter !== 'all';
                
                if (count > 0 || hasFilteredFiles) {
                    batchActions.classList.add('show');
                    
                    // Êõ¥Êñ∞Âà†Èô§Á≠õÈÄâÊåâÈíÆÁöÑÊòæÁ§∫Áä∂ÊÄÅ
                    const deleteFilteredBtn = batchActions.querySelector('.btn.warning');
                    if (deleteFilteredBtn) {
                        if (hasFilteredFiles) {
                            deleteFilteredBtn.style.display = 'inline-block';
                        } else {
                            deleteFilteredBtn.style.display = 'none';
                        }
                    }
                } else {
                    batchActions.classList.remove('show');
                }
            }
            
            // Êõ¥Êñ∞ÂÖ®ÈÄâÊ°ÜÁä∂ÊÄÅ
            if (selectAllCheckbox) {
                const filteredFiles = getFilteredFiles();
                if (filteredFiles.length === 0) {
                    selectAllCheckbox.indeterminate = false;
                    selectAllCheckbox.checked = false;
                } else if (count === filteredFiles.length) {
                    selectAllCheckbox.indeterminate = false;
                    selectAllCheckbox.checked = true;
                } else if (count > 0) {
                    selectAllCheckbox.indeterminate = true;
                } else {
                    selectAllCheckbox.indeterminate = false;
                    selectAllCheckbox.checked = false;
                }
            }
        }

        // ÊâπÈáèÂà†Èô§Á≠õÈÄâÁªìÊûúÔºàÁÆ°ÁêÜÂëò‰∏ìÁî®Ôºâ
        function deleteFiltered() {
            const filteredFiles = getFilteredFiles();
            
            if (filteredFiles.length === 0) {
                alert('ÂΩìÂâçÁ≠õÈÄâÊù°‰ª∂‰∏ãÊ≤°ÊúâÊñá‰ª∂ÂèØÂà†Èô§');
                return;
            }
            
            let periodName = '';
            if (currentTimeFilter === 'specific' && specificDateFilter) {
                periodName = specificDateFilter.toLocaleDateString('zh-CN');
            } else {
                const periodNames = {
                    'all': 'ÂÖ®ÈÉ®',
                    'today': '‰ªäÊó•',
                    'week': 'Êú¨Âë®', 
                    'month': 'Êú¨Êúà'
                };
                periodName = periodNames[currentTimeFilter] || 'Á≠õÈÄâ';
            }
            
            if (confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§${periodName}ÁöÑ ${filteredFiles.length} ‰∏™Êñá‰ª∂ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ`)) {
                const filteredIds = new Set(filteredFiles.map(file => file.id));
                files = files.filter(file => !filteredIds.has(file.id));
                selectedFiles.clear();
                saveData();
                updateFileDisplay();
                updateStats();
                alert(`ÊàêÂäüÂà†Èô§${periodName}ÁöÑ ${filteredFiles.length} ‰∏™Êñá‰ª∂ÔºÅ`);
            }
        }

        // ÊâπÈáèÂà†Èô§ÈÄâ‰∏≠Êñá‰ª∂
        function deleteSelected() {
            if (selectedFiles.size === 0) return;
            
            if (confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedFiles.size} ‰∏™Êñá‰ª∂ÂêóÔºü`)) {
                files = files.filter(file => !selectedFiles.has(file.id));
                selectedFiles.clear();
                saveData();
                updateFileDisplay();
                updateStats();
            }
        }

        // ËÆøÂÆ¢Êî∂Ëµ∑/Â±ïÂºÄÂäüËÉΩ
        function toggleFileView() {
            const fileList = document.getElementById('fileList');
            const toggleBtn = document.getElementById('toggleViewBtn');
            
            fileListCollapsed = !fileListCollapsed;
            
            if (fileListCollapsed) {
                fileList.classList.add('collapsed');
                toggleBtn.textContent = 'Â±ïÂºÄÂàóË°®';
            } else {
                fileList.classList.remove('collapsed');
                toggleBtn.textContent = 'Êî∂Ëµ∑ÂàóË°®';
            }
        }

        // Ëé∑ÂèñËøáÊª§ÂêéÁöÑÊñá‰ª∂
        function getFilteredFiles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            let filteredFiles = files.filter(file => 
                file.name.toLowerCase().includes(searchTerm)
            );

            // Â∫îÁî®Êó∂Èó¥Á≠õÈÄâ
            if (currentTimeFilter !== 'all') {
                if (currentTimeFilter === 'specific' && specificDateFilter) {
                    // Á≠õÈÄâÁâπÂÆöÊó•Êúü
                    filteredFiles = filteredFiles.filter(file => {
                        const fileDate = new Date(file.uploadDate);
                        return fileDate.toDateString() === specificDateFilter.toDateString();
                    });
                } else {
                    // Á≠õÈÄâÊó∂Èó¥ÊÆµ
                    const now = new Date();
                    let startDate;

                    switch (currentTimeFilter) {
                        case 'today':
                            startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                            break;
                        case 'week':
                            const dayOfWeek = now.getDay();
                            const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
                            startDate = new Date(now.getTime() - daysToMonday * 24 * 60 * 60 * 1000);
                            startDate.setHours(0, 0, 0, 0);
                            break;
                        case 'month':
                            startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                            break;
                    }

                    if (startDate) {
                        filteredFiles = filteredFiles.filter(file => file.uploadDate >= startDate);
                    }
                }
            }

            return filteredFiles;
        }

        // Êñá‰ª∂ÊòæÁ§∫
        function updateFileDisplay() {
            const fileList = document.getElementById('fileList');
            const filteredFiles = getFilteredFiles();

            // Êõ¥Êñ∞ÂΩìÂâçÊòæÁ§∫Êñá‰ª∂Êï∞
            const visibleFilesElement = document.getElementById('visibleFiles');
            if (visibleFilesElement) {
                visibleFilesElement.textContent = filteredFiles.length;
            }

            if (filteredFiles.length === 0) {
                fileList.innerHTML = '<div class="no-files">Êú™ÊâæÂà∞ÂåπÈÖçÁöÑPDFÊñá‰ª∂</div>';
                updateSelectedCount();
                return;
            }

            fileList.innerHTML = filteredFiles.map(file => `
                <div class="file-item ${selectedFiles.has(file.id) ? 'selected' : ''}">
                    ${currentUser && currentUser.type === 'admin' ? `
                        <div class="file-checkbox">
                            <input type="checkbox" 
                                   ${selectedFiles.has(file.id) ? 'checked' : ''} 
                                   onchange="toggleFileSelection('${file.id}')">
                        </div>
                    ` : ''}
                    <div class="file-icon-simple">PDF</div>
                    <div class="file-info">
                        <div class="file-name-simple" title="${file.name}">${file.name}</div>
                        <div class="file-date-simple">${file.uploadDate.toLocaleString('zh-CN')}</div>
                    </div>
                    <div class="file-actions-simple">
                        <button class="btn" onclick="viewFile('${file.id}')">Êü•Áúã</button>
                        <button class="btn secondary" onclick="downloadFile('${file.id}')">‰∏ãËΩΩ</button>
                        ${currentUser && currentUser.type === 'admin' ? 
                            `<button class="btn danger" onclick="deleteFile('${file.id}')">Âà†Èô§</button>` : ''}
                    </div>
                </div>
            `).join('');
            
            updateSelectedCount();
        }

        // Êñá‰ª∂Êìç‰Ωú
        function viewFile(fileId) {
            const file = files.find(f => f.id == fileId);
            if (file) {
                const url = URL.createObjectURL(file.file);
                window.open(url, '_blank');
            }
        }

        function downloadFile(fileId) {
            const file = files.find(f => f.id == fileId);
            if (file) {
                const url = URL.createObjectURL(file.file);
                const a = document.createElement('a');
                a.href = url;
                a.download = file.name;
                a.click();
                URL.revokeObjectURL(url);
            }
        }

        function deleteFile(fileId) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Êñá‰ª∂ÂêóÔºü')) {
                files = files.filter(f => f.id != fileId);
                selectedFiles.delete(fileId);
                saveData();
                updateFileDisplay();
                updateStats();
            }
        }

        // ÊêúÁ¥¢ÂäüËÉΩ
        document.getElementById('searchInput').addEventListener('input', () => {
            selectedFiles.clear(); // ÊêúÁ¥¢Êó∂Ê∏ÖÁ©∫ÈÄâÊã©
            updateFileDisplay();
            updateStats(); // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØÔºåÂåÖÊã¨ÂΩìÂâçÊòæÁ§∫Êñá‰ª∂Êï∞
            updateSelectedCount(); // Êõ¥Êñ∞ÊâπÈáèÊìç‰ΩúÊåâÈíÆÁä∂ÊÄÅ
        });

        // ÁªüËÆ°ÂäüËÉΩ
        function showStats(period) {
            currentStatsView = period;
            
            document.querySelectorAll('.stats-nav .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateStatsDisplay();
        }

        function updateStatsDisplay() {
            const statsContent = document.getElementById('statsContent');
            const now = new Date();
            let startDate;

            switch (currentStatsView) {
                case 'week':
                    startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    break;
                case 'month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    break;
                case 'year':
                    startDate = new Date(now.getFullYear(), 0, 1);
                    break;
            }

            const periodFiles = files.filter(file => file.uploadDate >= startDate);
            
            if (periodFiles.length === 0) {
                statsContent.innerHTML = '<div class="no-files">Ê≠§Êó∂Èó¥ÊÆµÂÜÖÊó†‰∏ä‰º†ËÆ∞ÂΩï</div>';
                return;
            }

            const groupedByDate = {};
            periodFiles.forEach(file => {
                const dateKey = file.uploadDate.toDateString();
                if (!groupedByDate[dateKey]) {
                    groupedByDate[dateKey] = [];
                }
                groupedByDate[dateKey].push(file);
            });

            const statsHtml = Object.entries(groupedByDate)
                .sort(([a], [b]) => new Date(b) - new Date(a))
                .map(([date, dayFiles]) => `
                    <div class="stat-item">
                        <span>${new Date(date).toLocaleDateString('zh-CN')}</span>
                        <span>${dayFiles.length} ‰∏™Êñá‰ª∂</span>
                    </div>
                `).join('');

            statsContent.innerHTML = `
                <div class="stat-item total">
                    <span>ÊÄªËÆ°</span>
                    <span>${periodFiles.length} ‰∏™Êñá‰ª∂</span>
                </div>
                ${statsHtml}
            `;
        }

        function updateStats() {
            document.getElementById('totalFiles').textContent = files.length;
            
            const today = new Date();
            const todayFiles = files.filter(file => {
                return file.uploadDate.toDateString() === today.toDateString();
            });
            document.getElementById('todayFiles').textContent = todayFiles.length;
            
            // Êõ¥Êñ∞ÂΩìÂâçÊòæÁ§∫ÁöÑÊñá‰ª∂Êï∞
            const visibleFiles = getFilteredFiles();
            const visibleFilesElement = document.getElementById('visibleFiles');
            if (visibleFilesElement) {
                visibleFilesElement.textContent = visibleFiles.length;
            }
            
            // Êõ¥Êñ∞Êó∂Èó¥ÊÆµÁªüËÆ°ÂíåÊï∞ÊçÆÂàÜÊûê
            updateTimeStats();
            updateDataAnalysis();
            
            updateStatsDisplay();
        }

        // ÂàùÂßãÂåñ
        initializeData();
        updateUI();
        updateStats();
        
        // ËÆæÁΩÆÊó•ÊúüÈÄâÊã©Âô®ÁöÑÊúÄÂ§ßÂÄº‰∏∫‰ªäÂ§©
        document.getElementById('specificDate').max = new Date().toISOString().split('T')[0];
        
        // Èò≤Ê≠¢Êï¥‰∏™È°µÈù¢ÁöÑÊãñÊãΩÊñá‰ª∂ÈªòËÆ§Ë°å‰∏∫
        document.addEventListener('dragover', (e) => e.preventDefault());
        document.addEventListener('drop', (e) => e.preventDefault());
        
        // Ê∑ªÂä†Âø´Êç∑ÈîÆÊîØÊåÅÔºàÁÆ°ÁêÜÂëò‰∏ìÁî®Ôºâ
        document.addEventListener('keydown', (e) => {
            if (currentUser && currentUser.type === 'admin' && e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                document.getElementById('fileInput').click();
                showUploadStatus('üí° ÊèêÁ§∫ÔºöÊÇ®‰πüÂèØ‰ª•Áõ¥Êé•ÊãñÊãΩÊñá‰ª∂Âà∞‰∏ä‰º†Âå∫Âüü', 'uploading');
                setTimeout(() => showUploadStatus('', ''), 2000);
            }
        });
    </script>
</body>
</html>